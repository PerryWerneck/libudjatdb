<?xml version="1.0" encoding="UTF-8" ?>

<config>

	<module name='civetweb' required='no' />
	<module name='information' required='no' />

	<!--
		Use attribute for database URL to avoid repetitions.
	-->
	<attribute name='database-connection' value='sqlite3:db=/tmp/test.sqlite;@pool_size=10' />

	<!--
	
		Run SQL script on service startup.
	
	-->
	<sql type='initializer'>
		create table if not exists sample (id integer primary key, inserted timestamp default CURRENT_TIMESTAMP, name text, value text);
	</sql>
	
	<!-- Build an SQL Based agent -->
	<sql name='count' type='agent' value-type='integer' retry-interval='14400' update-timer='14400'>
	
		<!-- Update agent value from SQL query -->
		<refresh>
			select count (*) as value from sample
		</refresh>
	
	</sql>

	<sql type='api-call' path='insert' action='get' response-type='value'>
		insert into sample (name,value) values (${1},${2});
		select last_insert_rowid() as id;
	</sql>

	<sql type='api-call' path='list' action='get' response-type='table'>
		select * from sample
	</sql>
	
	<alert name='orphaned' type='sql'>
		insert into sample (name,value) values ("alert","orphaned");
	</alert>
	
</config>

